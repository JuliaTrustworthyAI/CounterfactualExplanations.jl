```{julia}
using TaijaData
using CounterfactualExplanations
using TaijaPlotting
```

```{julia}
# Load data
multi_class_data = TaijaData.load_multi_class()
counterfactual_data = CounterfactualExplanations.DataPreprocessing.CounterfactualData(multi_class_data[1], multi_class_data[2])

M = fit_model(counterfactual_data, :MLP)

# Choose factual and target class
X = counterfactual_data.X
x = select_factual(counterfactual_data, rand(1:size(X, 2)))
y = predict_label(M, counterfactual_data, x)

target_non_trivial = rand(counterfactual_data.y_levels[counterfactual_data.y_levels .!= y[1]])
target_trivial = rand(counterfactual_data.y_levels[counterfactual_data.y_levels .== y[1]])

generator = CounterfactualExplanations.Generators.GrowingSpheresGenerator()

convergence = CounterfactualExplanations.Convergence.MaxIterConvergence()
```

```{julia}
counterfactual_explanation_non_trivial = generate_counterfactual(x, target_non_trivial, counterfactual_data, M, generator; convergence = convergence)
```

```{julia}
counterfactual_explanation_trivial = generate_counterfactual(x, target_trivial, counterfactual_data, M, generator; convergence = convergence)
```

```{julia}
TaijaPlotting.plot(counterfactual_explanation_non_trivial)
```

```{julia}
TaijaPlotting.plot(counterfactual_explanation_trivial)
```
