<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Binary target · CounterfactualExplanations.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://pat-alt.github.io/CounterfactualExplanations.jl/tutorials/binary/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CounterfactualExplanations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Binary target</a><ul class="internal"><li><a class="tocitem" href="#Default-generators"><span>Default generators</span></a></li></ul></li><li><a class="tocitem" href="../models/">Custom models</a></li><li><a class="tocitem" href="../multi/">Multi-class target</a></li><li><a class="tocitem" href="../generators/">Custom generators</a></li><li><a class="tocitem" href="../mutability/">Mutability constraints</a></li></ul></li><li><span class="tocitem">Counterfactual Generators</span><ul><li><a class="tocitem" href="../../generators/gradient_based/latent_space_generator/">Latent Space Search</a></li><li><a class="tocitem" href="../../generators/gradient_based/dice/">Diverse Counterfactuals</a></li></ul></li><li><span class="tocitem">More examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Image data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/image/MNIST/">MNIST</a></li></ul></li></ul></li><li><span class="tocitem">Contributor&#39;s Guide</span><ul><li><a class="tocitem" href="../../contributing/">Overview</a></li><li><a class="tocitem" href="../../contributing/interop/">Interoperability</a></li><li><a class="tocitem" href="../../contributing/loss/">Loss functions</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../resources/resources/">Additional Resources</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Binary target</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Binary target</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pat-alt/CounterfactualExplanations.jl/blob/main/docs/src/tutorials/binary.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Binary-classification"><a class="docs-heading-anchor" href="#Binary-classification">Binary classification</a><a id="Binary-classification-1"></a><a class="docs-heading-anchor-permalink" href="#Binary-classification" title="Permalink"></a></h1><p>To understand the core functionality of <code>CounterfactualExplanations.jl</code> we will look at two example use cases of the <code>generate_counterfactual</code> function. This function takes a structure of type <code>AbstractGenerator</code> as its main argument. You can utilize one of the <a href="#default-generators">default generators</a>: <code>GenericGenerator &lt;: AbstractGenerator</code>, <code>GreedyGenerator &lt;: AbstractGenerator</code>. Alternatively, you can also create your own custom generators as we will see in own of the following sections.</p><h2 id="Default-generators"><a class="docs-heading-anchor" href="#Default-generators">Default generators</a><a id="Default-generators-1"></a><a class="docs-heading-anchor-permalink" href="#Default-generators" title="Permalink"></a></h2><h3 id="GenericGenerator"><a class="docs-heading-anchor" href="#GenericGenerator"><code>GenericGenerator</code></a><a id="GenericGenerator-1"></a><a class="docs-heading-anchor-permalink" href="#GenericGenerator" title="Permalink"></a></h3><p>Let <em>t</em> ∈ {0, 1} denote the target label, <em>M</em> the model (classifier) and x′ ∈ ℝᴰ the vector of counterfactual features. In order to generate recourse the <code>GenericGenerator</code> optimizes the following objective function through steepest descent</p><p class="math-container">\[x\prime = \arg \min_{x\prime}  \ell(M(x\prime),t) + \lambda h(x\prime)\]</p><p>where ℓ denotes some loss function targeting the deviation between the target label and the predicted label and <em>h</em>(⋅) is a complexity penalty generally addressing the <em>realism</em> or <em>cost</em> of the proposed counterfactual.</p><p>Let’s generate some toy data:</p><pre><code class="language-julia hljs"># Some random data:
using CounterfactualExplanations.Data
Random.seed!(1234)
N = 25
w = [1.0 1.0]# true coefficients
b = 0
xs, ys = Data.toy_data_linear(N)
X = hcat(xs...)
counterfactual_data = CounterfactualData(X,ys&#39;)
plt = plot()
plt = plot_data!(plt,X&#39;,ys);
savefig(plt, joinpath(www_path, &quot;binary_samples.png&quot;))</code></pre><p><img src="../www/binary_samples.png" alt/></p><p>For this toy data we will now generate counterfactual explanations as follows:</p><ul><li>Use the coefficients <code>w</code> and <code>b</code> (assumed to be known or estimated) to define our model using <code>CounterfactualExplanations.Models.LogisticModel(w, b)</code>. (The first figure below shows the posterior predictive surface for this plugin estimator.)</li><li>Define our <code>GenericGenerator</code>.</li><li>Generate counterfactual.</li></ul><pre><code class="language-julia hljs"># Logit model:
using CounterfactualExplanations.Models: LogisticModel, probs 
M = LogisticModel(w, [b])
# Randomly selected factual:
Random.seed!(123)
x = select_factual(counterfactual_data,rand(1:size(X)[2]))
y = round(probs(M, x)[1])
target = ifelse(y==1.0,0.0,1.0) # opposite label as target

# Define generator:
generator = GenericGenerator()

# Generate explanations:
counterfactual = generate_counterfactual(x, target, counterfactual_data, M, generator)</code></pre><p><img src="../www/binary_contour.png" alt/></p><p>The animation below shows the resulting counterfactual path in the feature space (left) and the predicted probability (right). We can observe that the sample crosses the decision boundary and reaches the threshold target class probability <em>γ</em>.</p><p><img src="../www/binary_generic_recourse.gif" alt/></p><h3 id="GreedyGenerator"><a class="docs-heading-anchor" href="#GreedyGenerator"><code>GreedyGenerator</code></a><a id="GreedyGenerator-1"></a><a class="docs-heading-anchor-permalink" href="#GreedyGenerator" title="Permalink"></a></h3><p>Next we will repeat the exercise above, but instead use the <code>GreedyGenerator</code> in the context of a Bayesian classifier. This generator is greedy in the sense that it simply chooses the most salient feature {x′}ᵈ where</p><p class="math-container">\[d=\arg\max_{d \in [1,D]} \nabla_{x\prime} \ell(M(x\prime),t)\]</p><p>and perturbs it by a fixed amount <em>δ</em>. In other words, optimization is penalty-free. This is possible in the Bayesian context, because maximizing the predictive probability corresponds to minimizing the predictive uncertainty: by construction the generated counterfactual will therefore be <em>realistic</em> (low epistemic uncertainty) and <em>unambiguous</em> (low aleotoric uncertainty).</p><pre><code class="language-julia hljs">using LinearAlgebra
Σ = Symmetric(reshape(randn(9),3,3).*0.01 + UniformScaling(1)) # MAP covariance matrix
μ = hcat(b, w)
M = CounterfactualExplanations.Models.BayesianLogisticModel(μ, Σ)
generator = GreedyGenerator(;δ=0.1,n=25))
counterfactual = generate_counterfactual(x, target, counterfactual_data, M, generator)</code></pre><p>Once again we plot the resulting counterfactual path (left) and changes in the predicted probability (right). For the Bayesian classifier predicted probabilities fan out: uncertainty increases in regions with few samples. Note how the greedy approach selects the same most salient feature over and over again until its exhausted.</p><p><img src="../www/binary_greedy_recourse.gif" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../models/">Custom models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 24 January 2023 16:47">Tuesday 24 January 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
