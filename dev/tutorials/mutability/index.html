<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mutability constraints · CounterfactualExplanations.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://pat-alt.github.io/CounterfactualExplanations.jl/tutorials/mutability/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CounterfactualExplanations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../cats_dogs/">Motivating example</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../binary/">Binary target</a></li><li><a class="tocitem" href="../models/">Custom models</a></li><li><a class="tocitem" href="../multi/">Multi-class target</a></li><li><a class="tocitem" href="../generators/">Custom generators</a></li><li class="is-active"><a class="tocitem" href>Mutability constraints</a><ul class="internal"><li><a class="tocitem" href="#Mutability"><span>Mutability</span></a></li><li><a class="tocitem" href="#Domain-constraints"><span>Domain constraints</span></a></li></ul></li><li><a class="tocitem" href="../interop/">Interoperability</a></li></ul></li><li><span class="tocitem">Counterfactual Generators</span><ul><li><a class="tocitem" href="../../generators/gradient_based/latent_space_generator/">Latent Space Search</a></li><li><a class="tocitem" href="../../generators/gradient_based/dice/">Diverse Counterfactuals</a></li></ul></li><li><span class="tocitem">More examples</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Image data</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/image/MNIST/">MNIST</a></li></ul></li></ul></li><li><span class="tocitem">Contributor&#39;s Guide</span><ul><li><a class="tocitem" href="../../contributing/">Overview</a></li><li><a class="tocitem" href="../../contributing/interop/">Interoperability</a></li><li><a class="tocitem" href="../../contributing/loss/">Loss functions</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../resources/resources/">Additional Resources</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Mutability constraints</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mutability constraints</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pat-alt/CounterfactualExplanations.jl/blob/main/docs/src/tutorials/mutability.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mutability-and-domain-constraints"><a class="docs-heading-anchor" href="#Mutability-and-domain-constraints">Mutability and domain constraints</a><a id="Mutability-and-domain-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Mutability-and-domain-constraints" title="Permalink"></a></h1><p>In practice, features usually cannot be perturbed arbitrarily. Suppose, for example, that one of the features used by a bank to predict the credit worthiness of its clients is <em>gender</em>. If a counterfactual explanation for the prediction model indicates that female clients should change their gender to improve their credit worthiness, then this is an interesting insight (it reveals gender bias), but it is not usually an actionable transformation in practice. In such cases we may want to constrain the mutability of features to ensure actionable and realistic recourse. To illustrate how this can be implemented in <code>CounterfactualExplanations.jl</code> we will look at the linearly separable toy dataset again.</p><pre><code class="language-julia hljs"># Data:
using CounterfactualExplanations.Data
xs, ys = Data.toy_data_linear()
X = hcat(xs...)

# Model
w = [1.0 1.0]# true coefficients
b = 0
using CounterfactualExplanations.Models: LogisticModel, probs 
# Logit model:
M = LogisticModel(w, [b])</code></pre><h2 id="Mutability"><a class="docs-heading-anchor" href="#Mutability">Mutability</a><a id="Mutability-1"></a><a class="docs-heading-anchor-permalink" href="#Mutability" title="Permalink"></a></h2><p>Mutability of features can be defined in terms of four different options: 1) the feature is mutable in both directions, 2) the feature can only increase (e.g. age), 3) the feature can only decrease (e.g. time left until your next deadline) and 4) the feature is not mutable (e.g. skin colour, ethnicity, …). To specify which category a feature belongs to, you can pass a vector of symbols containing the mutability constraints at the pre-processing stage. For each feature you can choose from these four options: <code>:both</code> (mutable in both directions), <code>:increase</code> (only up), <code>:decrease</code> (only down) and <code>:none</code> (immutable). By default, <code>nothing</code> is passed to that keyword argument and it is assumed that all features are mutable in both directions.</p><p>Below we impose that the second feature is immutable. The resulting counterfactual path is shown in <a href="#fig-mutability">Figure 1</a> below. Since only the first feature can be perturbed, the sample can only move along the horizontal axis.</p><pre><code class="language-julia hljs">counterfactual_data = CounterfactualData(X,ys&#39;;mutability=[:both, :none])</code></pre><p><img src="../www/mutability_mutability.gif" alt="Figure 1: Counterfactual path with immutable feature."/></p><h2 id="Domain-constraints"><a class="docs-heading-anchor" href="#Domain-constraints">Domain constraints</a><a id="Domain-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Domain-constraints" title="Permalink"></a></h2><p>In some cases we may also want to constrain the domain of some feature. For example, age as a feature is constrained to a range from 0 to some upper bound corresponding perhaps to the average life expectancy of humans. Below, for example, we impose an upper bound of 0.5 for our two features. This results in the counterfactual path shown in <a href="#fig-mutability-domain">Figure 2</a>: since features are not allowed to be perturbed beyond the upper bound, the resulting counterfactual falls just short of the threshold probability <em>γ</em>.</p><pre><code class="language-julia hljs">counterfactual_data = CounterfactualData(X,ys&#39;;domain=(-Inf,0.5))</code></pre><p><img src="../www/mutability_domain.gif" alt="Figure 2: Counterfactual path with domain constraints."/></p><p>If we only want to constrain one particular feature to a certain domain we can pass a vector of tuples as below. In this case the resulting counterfactual path shown in <a href="#fig-mutability-domain-2">Figure 3</a> does converge to the desired threshold <em>γ</em>.</p><pre><code class="language-julia hljs">counterfactual_data = CounterfactualData(X,ys&#39;;domain=[(-Inf,Inf),(-Inf,-0.5)])</code></pre><p><img src="../www/mutability_domain_2.gif" alt="Figure 3: Counterfactual path with only one feature constrained to a certain domain."/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../generators/">« Custom generators</a><a class="docs-footer-nextpage" href="../interop/">Interoperability »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Tuesday 26 July 2022 04:59">Tuesday 26 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
