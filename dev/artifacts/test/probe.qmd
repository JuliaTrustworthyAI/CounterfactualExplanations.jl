```{julia}
using Pkg
Pkg.activate("dev/artifacts/test")
using Revise
```

```{julia}
using CounterfactualExplanations
using CounterfactualExplanations.Data
using CounterfactualExplanations.Generators
```

```{julia}

counterfactual_data = load_linearly_separable()
M = fit_model(counterfactual_data, :Linear)
target = 2
factual = 1
chosen = rand(findall(predict_label(M, counterfactual_data) .== factual))
x = select_factual(counterfactual_data, chosen)
# Search:
generator = ProbeGenerator()

```
```{julia}
ce = generate_counterfactual(
    x,
    target,
    counterfactual_data,
    M,
    generator;
    converge_when=:invalidation_rate,
    max_iter=10000,
)
CounterfactualExplanations.plot(ce)

```

```{julia}
n_dim = 2
n_classes = 4
n_samples = 400
model_name = :MLP
counterfactual_data = load_blobs(n_samples; k=n_dim, centers=n_classes)
counterfactual_data.standardize = true
M = fit_model(counterfactual_data, :MLP)
target = 2
factual = 4
chosen = rand(findall(predict_label(M, counterfactual_data) .== factual))
x = select_factual(counterfactual_data, chosen)
# Search:
generator = ProbeGenerator()
ce = generate_counterfactual(
    x,
    target,
    counterfactual_data,
    M,
    generator;
    converge_when=:invalidation_rate,
    max_iter=10000,
)
CounterfactualExplanations.plot(ce)
```

```{julia}
ce2 = generate_counterfactual(x, target, counterfactual_data, M, GenericGenerator())
```
```{julia}
counterfactual_data = load_moons()
M = fit_model(counterfactual_data, :MLP)
target = 1
factual = 0
chosen = rand(findall(predict_label(M, counterfactual_data) .== factual))
x = select_factual(counterfactual_data, chosen)
# Search:
generator = ProbeGenerator()
```

```{julia}
# CounterfactualExplanations.plot(ce2)
moons = generate_counterfactual(
    x, target, counterfactual_data, M, generator; converge_when=:invalidation_rate
)
CounterfactualExplanations.plot(moons)

```
