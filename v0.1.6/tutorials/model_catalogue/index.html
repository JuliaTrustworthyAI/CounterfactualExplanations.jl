<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model Catalogue · CounterfactualExplanations.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://pat-alt.github.io/CounterfactualExplanations.jl/tutorials/model_catalogue/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="CounterfactualExplanations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">CounterfactualExplanations.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">🏠 Home</a></li><li><span class="tocitem">🫣 Tutorials</span><ul><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../whistle_stop/">Whiste-Stop Tour</a></li><li><a class="tocitem" href="../data_preprocessing/">Handling Data</a></li><li><a class="tocitem" href="../data_catalogue/">Data Catalogue</a></li><li><a class="tocitem" href="../models/">Handling Models</a></li><li class="is-active"><a class="tocitem" href>Model Catalogue</a><ul class="internal"><li><a class="tocitem" href="#Available-Models"><span>Available Models</span></a></li><li><a class="tocitem" href="#Fitting-Models"><span>Fitting Models</span></a></li><li><a class="tocitem" href="#Tuning-Models"><span>Tuning Models</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><span class="tocitem">🤓 Explanation</span><ul><li><a class="tocitem" href="../../explanation/">Overview</a></li><li><a class="tocitem" href="../../explanation/architecture/">Package Architecture</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Generators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../explanation/generators/overview/">Overview</a></li><li><a class="tocitem" href="../../explanation/generators/generic/">Generic</a></li><li><a class="tocitem" href="../../explanation/generators/gravitational/">Gravitational</a></li><li><a class="tocitem" href="../../explanation/generators/revise/">REVISE</a></li><li><a class="tocitem" href="../../explanation/generators/dice/">DiCE</a></li><li><a class="tocitem" href="../../explanation/generators/clap_roar/">ClaPROAR</a></li><li><a class="tocitem" href="../../explanation/generators/greedy/">Greedy</a></li></ul></li><li><a class="tocitem" href="../../explanation/categorical/">Categorical Features</a></li></ul></li><li><span class="tocitem">🫡 How-To ...</span><ul><li><a class="tocitem" href="../../how_to_guides/">Overview</a></li><li><a class="tocitem" href="../../how_to_guides/custom_generators/">... add custom generators</a></li><li><a class="tocitem" href="../../how_to_guides/custom_models/">... add custom models</a></li></ul></li><li><a class="tocitem" href="../../_reference/">🧐 Reference</a></li><li><a class="tocitem" href="../../_contribute/">🛠 Contribute</a></li><li><a class="tocitem" href="../../assets/_resources/">📚 Additional Resources</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">🫣 Tutorials</a></li><li class="is-active"><a href>Model Catalogue</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model Catalogue</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pat-alt/CounterfactualExplanations.jl/blob/main/docs/src/tutorials/model_catalogue.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Model-Catalogue"><a class="docs-heading-anchor" href="#Model-Catalogue">Model Catalogue</a><a id="Model-Catalogue-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Catalogue" title="Permalink"></a></h1><p>While in general it is assumed that users will use this package to explain their pre-trained models, we provide out-of-the-box functionality to train various simple default models. In this tutorial, we will see how these models can be fitted to <code>CounterfactualData</code>.</p><h2 id="Available-Models"><a class="docs-heading-anchor" href="#Available-Models">Available Models</a><a id="Available-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Available-Models" title="Permalink"></a></h2><p>The <code>model_catalogue</code> can be used to inspect the available default models:</p><pre><code class="language-julia hljs">model_catalogue</code></pre><pre><code class="nohighlight hljs">Dict{Symbol, Any} with 3 entries:
  :Linear       =&gt; Linear
  :DeepEnsemble =&gt; FluxEnsemble
  :MLP          =&gt; FluxModel</code></pre><p>As with the <a href="tutorials/@ref"><code>data_catalogue</code></a>, the dictionary keys correspond to the model names. In this case, the dictionary values are constructors that can be used called on instances of type <code>CounterfactualData</code> to fit the corresponding model. In most cases, users will find it most convenient to use the <a href="../../_reference/#CounterfactualExplanations.Models.fit_model"><code>fit_model</code></a> API call instead.</p><h2 id="Fitting-Models"><a class="docs-heading-anchor" href="#Fitting-Models">Fitting Models</a><a id="Fitting-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-Models" title="Permalink"></a></h2><p>First, let’s load one of the synthetic datasets:</p><pre><code class="language-julia hljs">n = 500
counterfactual_data = load_multi_class(n)</code></pre><p>We could use a Deep Ensemble (Lakshminarayanan, Pritzel, and Blundell 2016) as follows:</p><pre><code class="language-julia hljs">M = fit_model(counterfactual_data, :DeepEnsemble)</code></pre><p>The returned object is an instance of type <code>FluxEnsemble &lt;: AbstractFittedModel</code> and can be used in downstream tasks without further ado. For example, the resulting fit can be visualised using the generic <code>plot()</code> method as:</p><pre><code class="language-julia hljs">plts = []
for target in counterfactual_data.y_levels
    plt = plot(M, counterfactual_data; target=target, title=&quot;p(y=$(target)|x,θ)&quot;)
    plts = [plts..., plt]
end
plot(plts...)</code></pre><p><img src="../model_catalogue_files/figure-commonmark/cell-6-output-1.svg" alt/></p><h2 id="Tuning-Models"><a class="docs-heading-anchor" href="#Tuning-Models">Tuning Models</a><a id="Tuning-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Tuning-Models" title="Permalink"></a></h2><p>By default, model architectures are very simple. Through optional arguments, users have some control over the neural network architecture and can choose to impose regularization through dropout. Let’s tackle a more challenging dataset: MNIST (LeCun 1998).</p><pre><code class="language-julia hljs">counterfactual_data = load_mnist(10000)
train_data, test_data = 
    CounterfactualExplanations.DataPreprocessing.train_test_split(counterfactual_data)</code></pre><p><img src="../model_catalogue_files/figure-commonmark/cell-8-output-1.svg" alt/></p><p>In this case, we will use a Multi-Layer Perceptron (MLP) but we will adjust the model and training hyperparameters. Parameters related to training of <code>Flux.jl</code> models are currently stored in a mutable container:</p><pre><code class="language-julia hljs">flux_training_params</code></pre><pre><code class="nohighlight hljs">CounterfactualExplanations.FluxModelParams
  loss: Symbol logitbinarycrossentropy
  opt: Symbol Adam
  n_epochs: Int64 100
  batchsize: Int64 1
  verbose: Bool false</code></pre><p>In cases like this one, where model training can be expected to take a few moments, it can be useful to activate verbosity, so let’s set the corresponding field value to <code>true</code>. We’ll also impose mini-batch training:</p><pre><code class="language-julia hljs">flux_training_params.verbose = true
flux_training_params.batchsize = round(size(train_data.X,2)/10)</code></pre><p>To account for the fact that this is a slightly more challenging task, we will use an appropriate number of hidden neurons per layer. We will also activate dropout regularization. To scale networks up further, it is also possible to adjust the number of hidden layers, which we will not do here.</p><pre><code class="language-julia hljs">model_params = (
    n_hidden = 32,
    dropout = true
)</code></pre><p>The <code>model_params</code> can be supplied to the familiar API call:</p><pre><code class="language-julia hljs">M = fit_model(train_data, :MLP; model_params...)</code></pre><pre><code class="nohighlight hljs">FluxModel(Chain(Dense(784 =&gt; 32, relu), Dropout(0.25), Dense(32 =&gt; 10)), :classification_multi)</code></pre><p>The model performance on our test set can be evaluated as follows:</p><pre><code class="language-julia hljs">model_evaluation(M, test_data)</code></pre><pre><code class="nohighlight hljs">0.9269093812317137</code></pre><p>Finally, let’s restore the default training parameters:</p><pre><code class="language-julia hljs">CounterfactualExplanations.reset!(flux_training_params)</code></pre><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>Lakshminarayanan, Balaji, Alexander Pritzel, and Charles Blundell. 2016. “Simple and Scalable Predictive Uncertainty Estimation Using Deep Ensembles.” <a href="https://arxiv.org/abs/1612.01474">https://arxiv.org/abs/1612.01474</a>.</p><p>LeCun, Yann. 1998. “The MNIST Database of Handwritten Digits.”</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../models/">« Handling Models</a><a class="docs-footer-nextpage" href="../../explanation/">Overview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 2 February 2023 09:45">Thursday 2 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
